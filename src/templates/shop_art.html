<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="UTF-8">
    <title>Art Showcase</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', path='/styles_shop_art.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', path='/general_styles.css') }}">
    <script async src="https://js.stripe.com/v3/"></script>
    <script src="{{ url_for('static', path='/toggle_menu_shop_art.js') }}"></script>
    <script src="{{ url_for('static', path='/general_scripts.js') }}"></script>
    <link rel="shortcut icon" href="/static/favicon.ico" type="image/x-icon">
</head>
<body>
<div class="header">
    <div class="brigLogo">
        <img src="{{ brig_logo_url }}" oncontextmenu="return false;">
    </div>
    <div class="navbar">
        <a class= "home" href="/">HOME</a>
        <a class= "giclee" href="/giclee_prints">GICLÉE PRINTS</a>
        <a class= "shop" href="/shop_art_menu">SHOP ART</a>
        <a class= "cart_a" onclick = "checkoutRedirect()">
            <div class="icon-cart" style="clear: left; float: left">
                <div class="icon-wrapper">
                    <div class="cart-line-1" style="background-color: white;"></div>
                    <div class="cart-line-2" style="background-color: white;"></div>
                    <div class="cart-line-3" style="background-color: white;"></div>
                    <div class="cart-wheel" style="background-color: white;"></div>
                </div>                
            </div>
        </a>
        <span id="cartQuantity" class="cart-quantity"></span>
    </div>
    <div class="mobile-menu">
        <div class="hamburger-icon">
            <label class="hambuger-menu" onclick="toggleIcon(); toggleDropdown()" >
                <div id="nav-icon3">
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                  </div>
            </label>
        </div>
        <a onclick = "checkoutRedirect()">
            <div class="icon-cart" style="clear: left; float: left">
                <div class="icon-wrapper">
                    <div class="cart-line-1" style="background-color: white;"></div>
                    <div class="cart-line-2" style="background-color: white;"></div>
                    <div class="cart-line-3" style="background-color: white;"></div>
                    <div class="cart-wheel" style="background-color: white;"></div>
                </div>                
            </div>
        </a>
        <span id="mobileCartQuantity" class="cart-quantity-mobile"></span>
        <div class="mobile-dropdown">
            <a href="/">HOME</a>
            <a href="/giclee_prints">GICLÉE PRINTS</a>
            <a href="/shop_art_menu">SHOP ART</a>
        </div>
    </div>
</div>
<div class="content">
    <div class="content_cart">
        <h1 id="more-shop">Shopping Cart</h1>
        <div class="shop-more">
            <div class="shop-more-wrapper">
                
            </div>
        </div>
        {% for img_data in img_data_list %}
        <div class="info_container">
            <div class="image_container">
                <div style="background-image: url('{{ img_data.img_url }}');" oncontextmenu="return false;" draggable="false" class="artwork"></div>
            </div>
            <div class="title_container">
                <p>{{ img_data.img_title }}</p>
            </div>
            <div class="quantity-container">
                <div class = "quantity-controls">
                    <div class = "quantity-control-wrapper">
                        <div class="decrease-quantity-btn-wrapper">
                            <button class="decrease-quantity" onclick="decreaseQuantity(this)">-</button>
                        </div>
                        <div class="quantity-input-wrapper">
                            <input id= "price-quantity" class = "quantity-input" font-size = "16px" value = "{{ img_data.quantity }}" type="number" readonly>
                        </div>
                        <div class="increase-quantity-btn-wrapper">
                            <button class="increase-quantity" onclick="increaseQuantity(this)">+</button>
                        </div>
                    </div> 
                    <div class="remove-item-wrapper">
                        <div class="price-container">
                            <p class="price" id="price-text">${{ img_data.price }}</p>
                            
                        </div>
                        <div class="price-remove-container">
                            <button class="remove-item" onclick="removeItemButton(this)">X</button>
                        </div>
                    </div>                                 
                </div>
            </div>
        </div>
        {% endfor %}
        <div class = "checkout-container">
            <div class="price-container">
                <p class="total">Subtotal: <span id="total-price" class="total-amount">Loading...</span></p>
                <div class="loading-bar-container">
                    <div class="loading-bar"></div>
                </div>
            </div>
            <button class="checkout-btn">CHECKOUT</button>
            <div class="session-timer">
                <p>Session expires in: <span id="timer">Loading...</span></p>
            </div>
        </div>
    </div>
</div>

<footer class="footer">
    <div class="container">
        <p>&copy; <span id="currentYear"></span> Art Ecommerce, LLC. All rights reserved.</p>
    </div>
</footer>
<script>
    async function fetchSessionTime() {
        const response = await fetch('/get_session_time');
        const data = await response.json();
        return data.remaining_time;
    }

    async function deleteSession() {
    try {
        const response = await fetch('/delete_session', { method: 'POST' });
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        // Reload the page after deleting the session
        window.location.reload();
    } catch (error) {
        console.error('Error deleting session:', error);
    }
}

function startTimer(duration, display) {
    let timer = duration, minutes, seconds;
    const interval = setInterval(() => {
        minutes = parseInt(timer / 60, 10);
        seconds = parseInt(timer % 60, 10);

        minutes = minutes < 10 ? "0" + minutes : minutes;
        seconds = seconds < 10 ? "0" + seconds : seconds;

        display.textContent = minutes + ":" + seconds;

        if (--timer < 0) {
            clearInterval(interval);
            deleteSession();
        }
    }, 1000);
}
    document.addEventListener('DOMContentLoaded', async () => {
        const remainingTime = await fetchSessionTime();
        const display = document.querySelector('#timer');
        startTimer(remainingTime, display);
    });
</script>
</body>
</html>
